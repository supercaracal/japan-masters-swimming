---
version: "3"
services:
  db:
    build:
      context: "./docker/db"
      args:
        - "BASE_BACKUP_FILE=swim_db_basebackup_${BASE_BACKUP_DATE}.tar.gz"
    environment:
      - "POSTGRES_PASSWORD=${POSTGRES_PASSWORD}"
    ports:
      - "${DB_PORT}:5432"
  web:
    image: "supercaracal/amazon-linux-rails-app"
    depends_on:
      - "db"
    environment:
      - "REPO=https://github.com/supercaracal/japan-masters-swimming.git"
      - "BRANCH=master"
      - "RAILS_ENV=production"
      - "SECRET_KEY_BASE=${SECRET_KEY_BASE}"
      - "DB_HOST=db"
      - "DB_PORT=${DB_PORT}"
      - "DB_PASSWORD=${POSTGRES_PASSWORD}"
    ports:
      - "${WEB_PORT}:80"
